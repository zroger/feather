#!/usr/bin/env php
<?php

system('rm -rf *.phar *.tgz');
system('composer update');

require_once dirname(__FILE__) . "/../vendor/autoload.php";

use Herrera\Box\Box;
use Herrera\Box\StubGenerator;
use Symfony\Component\Finder\Finder;

$base = dirname(__DIR__);

$finder = new Finder();
$finder->files()
    ->ignoreVCS(true)
    ->name('*.php')
    ->name('*.yml')
    ->name('*.twig')
    ->notName('PharCompiler.php')
    ->notName('PearCompiler.php')
    ->in($base . '/bin')
    ->in($base . '/src')
    ->in($base . '/vendor');

$box = Box::create('feather.phar');
$box->buildFromIterator($finder, $base);
$box->getPhar()->setStub(
    StubGenerator::create()
        ->index('bin/feather-stub.php')
        ->generate()
);
